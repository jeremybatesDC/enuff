
<!doctype html>
<html lang="en">
<head>
<title>web.browser.console - complete.ly</title>
<script src='../js//complete.ly.1.0.1.edited.js'></script>
</head>
<body>

<style>
/* there are so many damn configurable inline styles that i have to override them
eventually need to rip them out of the js file.
*/
#completelyInputHolder[style] {border: 1px solid #000;height: 4em;}

</style>
<article>
    <h4>your tags</h4>
    <div id="completelyInputHolder">*</div>
    	

    
		<div id="inputOptions"></div>
	</article>
	<script>
	var pv = completely(document.getElementById('inputOptions'));
	
	var main = document.getElementById('completelyInputHolder');
	
	pv.onEnter = function() {
		var text = pv.input.value;
		try {
			resp = eval(text);	
		} catch (e) {
			resp = 'error:<i>'+e+'</i>';
		}
		var divIn = document.createElement('span');
		divIn.innerHTML = '-'+text + ' ';
		main.appendChild(divIn);
		pv.setText('');
		main.appendChild(pv.wrapper);
		pv.wrapper.scrollIntoView();
		setTimeout(function() { pv.input.onclick() },0); // for IE
	}
	
	function extractTextForAutocompletion(code) {
		
		var isLetterOrDigitOrWhitespaceOrDot = function(ch) { 
			return ch === '.'         ||
			       (ch>='A'&&ch<='Z') ||
			       (ch>='a'&&ch<='z') ||
			       (ch>='0'&&ch<='9') ||
			       ch==='$'           ||
			       ch==='_'           ||
			       ' \n\r\t\f\x0b\xa0\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u200b\u2028\u2029\u3000'.indexOf(ch) !==-1; // whitespaces
		};
		
		var snip = code;
		for (var i=code.length-1;i>=0;i--) {
			var ch = code.charAt(i);
			if (isLetterOrDigitOrWhitespaceOrDot(ch)===false) {
				snip = code.substring(i+1);
				break; 
			}
		}
		
		var ix = snip.lastIndexOf('.');
		if (ix === -1) return { v1 :'', v2 : snip };
		else           return { v1 : snip.substring(0,ix),
			                    v2 : snip.substring(ix+1) };
		
	};
	
	pv.options = ['coffee','cocoa','apple'];
	pv.options.sort();
	pv.onChange = function (text) {
		if (text.length == 0) {
			pv.repaint();
			return; 
		}
		var v = extractTextForAutocompletion(text);
		
		try {
		   oj = eval(v.v1);
		} catch (ex) {
		   oj = null;
		}
		for (var i in oj) { pv.options.push(''+i); }
		pv.options.sort();
		pv.startFrom = text.lastIndexOf('.')+1;
		pv.repaint();
	};
	
	setTimeout(function() { pv.input.onclick() },0);
	</script>
</body>
</html>

(function(e){"use strict";if(!Function.prototype.bind){Function.prototype.bind=function(e){if(typeof this!=="function"){throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable")}var t=Array.prototype.slice.call(arguments,1),n=this,r=function(){return},i=function(){return n.apply(this instanceof r&&e?this:e,t.concat(Array.prototype.slice.call(arguments)))};r.prototype=this.prototype;i.prototype=new r;return i}}var t={publicMethods:["validate","formatString","destroy","reload","getFormHandle","getFields"],className:"Validator"},n=function(e,t,n){this.settings={onAir:true,showErrors:true,autoHideErrors:false,autoHideErrorsTimeout:2e3,locale:"en",messages:{},rules:{},removeSpaces:false};this.errorClassName="error";this.messages={en:{required:{empty:"This field is required",incorrect:"Incorrect value"},notzero:{empty:"Please make a selection",incorrect:"Incorrect value"},integer:{empty:"Enter an integer value",incorrect:"Incorrect integer value"},"float":{empty:"Enter an float number",incorrect:"Incorrect float"},min:{empty:"Enter more",incorrect:"Enter more"},max:{empty:"Enter less",incorrect:"Enter less"},between:{empty:"Enter the between {0}-{1}",incorrect:"Enter the between {0}-{1}"},name:{empty:"Please, enter your name",incorrect:"Incorrect name"},lastname:{empty:"Please, enter your lastname",incorrect:"Incorrect lastname"},phone:{empty:"Please, enter the phone number",incorrect:"Incorrect phone number"},email:{empty:"Please, enter your email address",incorrect:"Incorrect email address"},length:{empty:"Please, Enter a minimum of {0} characters and a maximum of {1}",incorrect:"Incorrect. Enter a minimum of {0} characters and a maximum of {1}"},minlength:{empty:"Please, enter at least {0} characters",incorrect:"You have entered less than {0} characters"},maxlength:{empty:"Please, enter at maximum {0} characters",incorrect:"You have entered more than {0} characters"},maxfilesize:{empty:"The size of one or more selected files larger than {0} {1}",incorrect:"The size of one or more selected files larger than {0} {1}"},fileextension:{empty:"Select file",incorrect:"One or more files have an invalid type"}}};if(!e){return false}var r=this,i=["keyup","change","blur"],s=i.length,o,u,a,f;this.formHandle=e||null;this.submitCallback=t||null;this.fields=this.getFields(this.formHandle.querySelectorAll("[data-rule]"));if(n){if(n.rules){for(a in n.rules){if(n.rules.hasOwnProperty(a)){this.rules[a]=n.rules[a]}}delete n.rules}for(a in n){if(n.hasOwnProperty(a)){this.settings[a]=n[a]}}}if(this.submitCallback){if(this.formHandle.addEventListener){this.formHandle.addEventListener("submit",r.events.submit.bind(this))}else{this.formHandle.attachEvent("onsubmit",r.events.submit.bind(this))}if(this.settings.onAir){o=function(e){if(this.intervalID){clearTimeout(this.intervalID)}this.intervalID=setTimeout(function(){r.events.change.apply(r,[e])},400)};u=function(e){e.srcElement.blur();e.srcElement.focus()};for(a in this.fields){if(this.fields.hasOwnProperty(a)){for(f=0;f<s;f+=1){if(this.fields[a].handle.addEventListener){if(i[f]==="keyup"){this.fields[a].handle.addEventListener(i[f],o)}else{this.fields[a].handle.addEventListener(i[f],r.events.change.bind(this))}}else{this.fields[a].handle.attachEvent("on"+i[f],r.events.change.bind(this))}}if(!this.fields[a].handle.addEventListener){if(this.fields[a].handle.type==="radio"||this.fields[a].handle.type==="checkbox"){this.fields[a].handle.attachEvent("onclick",u)}}}}}}return this};n.prototype={formHandle:null,submitCallback:null,errors:null,fields:{},intervalID:null,ints:{},rules:{required:function(e){return""!==e},notzero:function(e){return parseInt(e,10)>0},integer:function(e){return(new RegExp(/^[0-9]+$/gi)).test(e)},"float":function(e){return(new RegExp(/^([0-9])+(\.)([0-9]+$)/gi)).test(e)},min:function(e,t){if(this.float(e)){return parseFloat(e)>=parseFloat(t[0])}return parseInt(e,10)>=parseInt(t[0],10)},max:function(e,t){if(this.float(e)){return parseFloat(e)<=parseFloat(t[0])}return parseInt(e,10)<=parseInt(t[0],10)},between:function(e,t){if(this.float(e)){return parseFloat(e)>=parseFloat(t[0])&&parseFloat(e)<=parseFloat(t[1])}if(this.integer(e)){return parseInt(e,10)>=parseInt(t[0],10)&&parseInt(e,10)<=parseInt(t[1],10)}return false},name:function(e){if(e.length>0&&e.length<2){return false}return(new RegExp(/^[a-zA-Z\sа-яА-ЯёЁ\-]+$/g)).test(e)},lastname:function(e){return this.name(e)},phone:function(e){if(e.match(/[0-9]+/gi)&&e.match(/[0-9]+/gi)[0].length<6){return false}return(new RegExp(/^(?:(?:\(?(?:00|\+)([1-4]\d\d|[1-9]\d?)\)?)?[\-\.\ \\\/]?)?((?:\(?\d{1,}\)?[\-\.\ \\\/]?){0,})(?:[\-\.\ \\\/]?(?:#|ext\.?|extension|x)[\-\.\ \\\/]?(\d+))?$/g)).test(e)},email:function(e){return(new RegExp(/^(("[\w-\s]+")|([\w\-]+(?:\.[\w\-]+)*)|("[\w-\s]+")([\w\-]+(?:\.[\w\-]+)*))(@((?:[\w\-]+\.)*\w[\w\-]{0,66})\.([a-z]{2,6}(?:\.[a-z]{2})?)$)|(@\[?((25[0-5]\.|2[0-4][0-9]\.|1[0-9]{2}\.|[0-9]{1,2}\.))((25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\.){2}(25[0-5]|2[0-4][0-9]|1[0-9]{2}|[0-9]{1,2})\]?$)/i)).test(e)},length:function(e,t){return this.between(e.replace(/\s{2,}/g," ").length,t)},maxlength:function(e,t){return this.max(e.replace(/\s{2,}/g," ").length,t)},minlength:function(e,t){return this.min(e.replace(/\s{2,}/g," ").length,t)},maxfilesize:function(e,t){var n,r=e.length,i=1;switch(t[1].toLowerCase()){case"b":i=1;break;case"kb":i=1024;break;case"mb":i=1048576;break;case"gb":i=1073741824;break;case"tb":i=1099511627776;break}for(n=0;n<r;n+=1){if(parseFloat(e[n])>parseFloat(t[0])*i){return false}}return true},fileextension:function(e,t){var n,r,i=t.length,s=e.length,o=0;for(n=0;n<i;n+=1){for(r=0;r<s;r+=1){if(t[n]===e[r].split(".").pop()){o+=1}}}return e.length===o?true:false}},orderFields:function(e,t){if(!e||!t){return{}}var n={},r;for(r in this.fields){if(this.fields.hasOwnProperty(r)){if(this.fields[r].handle[e]&&this.fields[r].handle[e]===t){n[r]=this.fields[r]}}}return n},validate:function(e){if(this.errors){this.errors=null}var t,n,r,i,s,o,u,a,f=true,l,c=null,h,p=false,d=[],v,m=this.fields;if(e){m=this.getFields([e])}for(t in m){if(m.hasOwnProperty(t)){f=true;r=m[t].rules.length;for(n=0;n<r;n+=1){o=m[t].rules[n][0];h=m[t].rules[n][1];a=m[t].defaultValue;u=m[t].handle.value;if(m[t].handle.type==="checkbox"&&!m[t].handle.checked){u=""}if(m[t].handle.type==="radio"){d=this.orderFields("name",m[t].handle.name);p=false;for(v in d){if(d.hasOwnProperty(v)){if(d[v].handle.checked){p=true}}}if(!p){for(v in d){if(d.hasOwnProperty(v)){try{l=this.settings.messages[this.settings.locale][o].empty}catch(g){l=this.messages[this.settings.locale][o].empty}break}}u=""}}if(m[t].handle.type==="file"){if(m[t].handle.files){s=m[t].handle.files.length;if(s>0){u=[];for(i=0;i<s;i+=1){switch(o){case"maxfilesize":u.push(m[t].handle.files[i].size);break;case"fileextension":u.push(m[t].handle.files[i].name);break}}}}}if(f&&!(u===""&&!m[t].rules.join("|").match(/\|{0,1}required\|{0,1}/))){if(f&&a&&u!==a){f=false;c="incorrect"}else if(f&&this.rules[o]&&!this.rules[o](u,h)){if(""===u){f=false;c="empty"}else{f=false;c="incorrect"}}if(f){this.hideErrors(m[t].handle,true)}else{if(!this.errors){this.errors={}}try{try{l=this.settings.messages[this.settings.locale][o][c]}catch(g){l=this.messages[this.settings.locale][o][c]}}catch(g){o="required";l=this.messages[this.settings.locale][o][c]}if(!h.length){h.push(u)}this.errors[t]={name:m[t].name,errorText:this.formatString(l,h)};if(!this.submitCallback){this.errors[t].handle=m[t].handle}}}}}}if(this.submitCallback){return this.errors?false:true}return this.errors||true},hideErrors:function(e,t){var n,r;for(n in this.fields){if(this.fields.hasOwnProperty(n)){if(e&&e===this.fields[n].handle||!e){if(document.getElementsByTagName("head")[0].nextElementSibling){r=this.fields[n].handle.nextElementSibling}else{r=this.fields[n].handle.nextSibling;if(r.nodeName==="#text"){r=r.nextSibling}}if(t){if(this.fields[n].handle.classList){this.fields[n].handle.classList.remove(this.errorClassName)}else{this.fields[n].handle.className=this.fields[n].handle.className.replace(new RegExp("(^|\\b)"+this.errorClassName.split(" ").join("|")+"(\\b|$)","gi")," ")}}if(r&&r.getAttribute("data-type")==="validator-error"){r.parentNode.removeChild(r)}}}}},showErrors:function(e){var t,n,r,i,s=this.settings.showErrors,o=this.errorClassName,u=function(e,t){if(e.classList){e.classList.add(o)}else{e.className+=" "+o}if(e.nextElementSibling&&e.nextElementSibling.getAttribute("data-type")==="validator-error"){return}if(s){r=document.createElement("div");r.setAttribute("class",o);r.setAttribute("data-type","validator-error");r.innerHTML=t.errorText;e.parentNode.insertBefore(r,e.nextSibling)}};for(t in this.errors){if(this.errors.hasOwnProperty(t)){if(e){for(n in this.fields){if(this.fields.hasOwnProperty(n)){if(this.fields[n].handle.getAttribute("name")===e.getAttribute("name")){u(this.fields[n].handle,this.errors[t])}}}}else{if(t==="0"||t>0&&this.fields[t].name!==this.fields[t-1].name){u(this.fields[t].handle,this.errors[t])}}}}if(this.settings.autoHideErrors){i=this;if(!e){if(this.intervalID){clearTimeout(this.intervalID)}this.intervalID=setTimeout(function(){i.intervalID=null;i.hideErrors(false)},this.settings.autoHideErrorsTimeout)}else{if(e.intervalID){clearTimeout(e.intervalID)}if(!this.intervalID){e.intervalID=setTimeout(function(){e.intervalID=null;i.hideErrors(e)},this.settings.autoHideErrorsTimeout)}}}},events:{submit:function(e){if(e.preventDefault){e.preventDefault()}else{e.returnValue=false}var t=this.validate(),n,r;this.hideErrors(false,true);if(!t){this.showErrors()}n=this.errors||null;r=this.errors?false:true;if(this.submitCallback(n,r)===true){this.formHandle.submit()}},change:function(e){var t,n;if(!e.target){e.target=e.srcElement}if(this.settings.removeSpaces&&(new RegExp(/\s{2,}/g)).test(e.target.value)){e.target.value=e.target.value.replace(/\s{2,}/g," ")}if(e.target.type==="radio"){t=this.orderFields("name",e.target.name);for(n in t){if(t.hasOwnProperty(n)){this.hideErrors(t[n].handle)}}}else{this.hideErrors(e.target)}if(!this.validate(e.target)){this.showErrors(e.target);if(!this.settings.showErrors){this.submitCallback(this.errors,false)}}}},getFields:function(e){e=e||this.formHandle.querySelectorAll("[data-rule]");var t={},n=[],r=[],i=e.length,s,o,u;for(s=0;s<i;s+=1){n=e[s].getAttribute("data-rule").split("|");u=n.length;for(o=0;o<u;o+=1){if(n[o].match(/-/gi)){r=n[o].split("-");n[o]=r[0];r=r.splice(1);n[o]=[n[o],r]}else{n[o]=[n[o],[]]}}t[s]={name:e[s].getAttribute("name"),rules:n,defaultValue:e[s].getAttribute("data-default"),handle:e[s],intervalID:null}}return t},getFormHandle:function(){return this.formHandle},formatString:function(e,t){return e.replace(/\{(\d+)\}/gi,function(e,n){return e&&t[n]?t[n]:""})},destroy:function(){this.hideErrors(false,true);var e=this.formHandle.cloneNode(true);this.formHandle.parentNode.replaceChild(e,this.formHandle)},reload:function(n,r){this.hideErrors(false,true);var i=this.formHandle.cloneNode(true);this.formHandle.parentNode.replaceChild(i,this.formHandle);this.formHandle=i;switch(arguments.length){case 2:this.submitCallback=n;this.settings=r;break;case 1:this.settings=n;break}e[t.className].apply(this,[this.formHandle,this.submitCallback,this.settings])}};e[t.className]=function(){function r(e,t){function n(){return e.apply(this,t)}n.prototype=e.prototype;return new n}var i=r(n,arguments),s,o=t.publicMethods.length;for(s=0;s<o;s+=1){(function(){var n=t.publicMethods[s];e[t.className].prototype[n]=function(){return i[n].apply(i,arguments)}})()}return this}})(this)